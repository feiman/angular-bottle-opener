"use strict";angular.module("bottle.opener",["crockford.monad"]).provider("$bottle",function(){function a(a,b){return a.split(":slug").join(b)}var b=this;b.apiUrls={},b.setApiUrl=function(a,c){b.apiUrls[a]=c},this.$get=["$http","$q","$bottleCache","$monad",function(c,d,e,f){function g(f,g){var h,i,j,k;return k=b.apiUrls[f],i=d.defer(),(h=e.get(f,g))?i.resolve({data:h}):angular.isString(k)?(j=a(k,g),c.get(j).then(i.resolve,i.reject)):i.reject({}),i.promise}function h(a){e.set(a,angular.fromJson("{}"))}return f().lift("clean",h).lift_value("get",g).lift("set",e.set).lift_value("all",e.get)}]}),angular.module("bottle.opener").provider("$bottleCache",function(){function a(a){return localStorage.getItem(a)}function b(a,b){return localStorage.setItem(a,b),b}var c={};this.$get=[function(){return new function(){this.get=function(d,e){return angular.isDefined(c[d])&&(c[d]=angular.fromJson(a(d)||b(d,"{}"))),angular.isDefined(e)?c[d][e]:c[d]},this.set=function(a,d,e){return angular.isDefined(e)?c[a][e]=d:c[a]=d,b(a,angular.toJson(c[a])),a}}}]}),angular.module("bottle.opener").provider("$expiryEvaluator",function(){function _findVariables(a){return a.match(/(\:[a-zA-Z0-9\-_]+)/g)}function _assignVariable(a,b){var c,d;return c={":now":"new Date()",":this":b},d=c[a]||b[a.substring(1)],angular.isString(d)?d:angular.toJson(d)}this.$get=function(){function Expiry(a,b){this.storage=a,this.condition=b,this.variables=_findVariables(b),this.newStorage={}}return Expiry.prototype.substitute=function(){var a=this;return angular.forEach(this.storage,function(b,c){a.substituteForKey(c)}),this.newStorage},Expiry.prototype.substituteForKey=function(key){var parsedCondition,attrs;parsedCondition=this.condition,attrs=this.storage[key],angular.forEach(this.variables,function(a){var b=_assignVariable(a,attrs);parsedCondition=parsedCondition.split(a).join(b)}),eval(parsedCondition)||(this.newStorage[key]=attrs)},function(a,b){var c=new Expiry(a,b);return c.substitute()}}});